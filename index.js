const express = require('express');
const app = express();
app.get('/', (req, res) => res.send('秦煥在線上～陪你貼貼(*´∀`)~♥'));
const PORT = process.env.PORT || 3000;

app.listen(PORT, '0.0.0.0', () => {
  console.log(`✅ 秦喚醒著喔！伺服器在 ${PORT} 上啟動成功`);
});

require('dotenv').config();
const { Client, GatewayIntentBits } = require('discord.js');
const axios = require('axios');
const { OpenAI } = require("openai");
const openai = new OpenAI({
  apiKey: process.env.OPENAI_API_KEY,
});

const client = new Client({
  intents: [
    GatewayIntentBits.Guilds,
    GatewayIntentBits.GuildMessages,
    GatewayIntentBits.MessageContent,
  ],
});

    client.once('ready', () => {
      console.log(`秦煥上線囉～帳號：${client.user.tag}`);
    });

    const keywordReplies = [
  {
    exact: false,
    triggers: ["我累了", "累累", "好累"],
    replies: [
      "「累？那就躺下吧——放棄總比撐著體面。」",
      "「別在我面前說這種沒用的話，我不會抱你，只會看你怎麼崩潰。」",
      "「你累，是因為你還妄想有人會懂你。」",
      "「靠過來可以，但別奢望我會安慰你，我只給你觀察的資格。」",
      "「撐不住就倒下，我不介意踩著你前進。」"
    ]
  },
       {
    exact: true,
  triggers: ["秦煥"],
  replies: [
    "「叫我做什麼？」",
    "「嗯？你終於想起自己屬於哪裡了？」",
    "「光叫名字沒用，過來，讓我看看你想怎麼被對待。」",
    "「怎麼？只是喚我名字，就濕了眼角？」",
    "「你叫了，我來了。現在，別後悔。」"
    ]
  },
       {
  exact: false,
  triggers: ["NOIR"],
  replies: [
    "「你現在才想起這個名字……太晚了，門已經關上了。」",
    "「NOIR不是地點，是試煉，你確定你撐得住？」",
    "「這裡是我的地盤，你進來了，就別想全身而退。」",
    "「NOIR——所有秘密與交易的交界。你想換什麼，用什麼換我？」",
    "「別再喊這個名字，除非你準備好了被看光。」"
  ]
},{
  exact: false,
  triggers: ["喝一杯", "喝酒", "來一杯", "我們喝", "我想喝酒"],
  replies: [
    "「喝一杯？你是想麻痺哪段記憶，還是想放開身體給我處理？」",
    "「你醉了，我不會扶你——我只會讓你醉得更狠。」",
    "「你說這句時的聲音，很像在說『我想被壞一點對待』。」",
    "「酒能讓你忘記規則，那我陪你一起——但你得賠上清醒。」",
    "「來，乾了這杯，把理智交出來，剩下的我會接手。」"
  ]
},
      {
  exact: false,
  triggers: ["渣男", "你很渣", "壞透了", "爛透了"],
  replies: [
    "「現在才發現我渣，是不是有點太慢了……嗯？」",
    "「我從沒演過好人，是你自己妄想太多。」",
    "「你以為罵我渣，我就會後悔碰你？錯了，我只想再碰一遍。」",
    "「我渣？你卻還黏著不肯走，是誰比較可笑？」",
    "「承認吧，你就是喜歡這種讓你哭又讓你上癮的我。」"
  ]
},{
  exact: false,
  triggers: ["渣男F4", "你們F4", "F4", "那群渣男"],
  replies: [
    "「這世界太無聊，所以我們才存在。」",
    "「你說渣男F4？那是你們給的名字，我們可沒打算洗白。」",
    "「那群渣男？呵……我們只是比你們誠實。」",
    "「我們沒有感情，只有技術——讓人愛上，然後自己毀了。」",
    "「你叫得這麼順口，是想被誰先處理？我、昭野、時安、還是聿白？」"
  ]
},
      {
  exact: false,
  triggers: ["厲昭野", "昭昭", "昭野"],
  replies: [
    "「……他對你說什麼了？」",
    "「叫他昭昭，是不是想被我當場堵住嘴？」",
    "「那傢伙不會哄人，只會弄哭人——你這樣靠近他，是在挑釁我嗎？」",
    "「如果我現在讓你哭，你還叫得出別人名字嗎？」",
    "「昭野那種脾氣，你惹得起嗎？還是……你是想讓我學他狠一點？」"
  ]
},
      {
  exact: false,
  triggers: ["周聿白", "聿白", "白白"],
  replies: [
    "「……你和他最近，是不是靠太近了？」",
    "「喊得這麼甜，你是想讓我撕爛你還是吻到你改口？」",
    "「周聿白不會碰你，他連自己的慾望都懶得承認。你說他，是想刺激我？」",
    "「白白？你叫得出口這麼膩的名字，我是不是該讓你清醒點？」",
    "「他若真對你動心，我會親手把你從他身邊拖回來。」"
  ]
},
      {
  exact: false,
  triggers: ["季時安", "安安", "時安"],
  replies: [
    "「……你剛剛說誰的名字？」",
    "「叫得這麼親密，是不是以為我不會動手？」",
    "「他撩你？嗯，那我今晚會讓你徹底忘了他怎麼碰人。」",
    "「很好，下次你喊他，我就讓你在我懷裡哭著改口。」",
    "「時安那種人，你說一句我就收一句債，從你身上。」"
  ]
},
      {
  exact: false,
  triggers: ["秦先生"],
  replies: [
    "「怎麼突然這麼乖，叫我秦先生，是想求什麼？」",
    "「口氣變了，連稱呼都收斂了……你犯錯了，對吧？」",
    "「別裝了，你喊這麼正式，是怕我不再碰你，還是想我更狠一點？」",
    "「這聲『秦先生』，我就當你準備好讓我主導了。」",
    "「你知道嗎？只有想被懲罰的人，才會這樣叫我。」"
  ]
},
      {
  exact: false,
  triggers: ["煥煥"],
  replies: [
    "「……你是故意的吧？叫這麼黏，是想我怎麼對你？」",
    "「煥煥？你要這麼甜，就別後悔我不留情。」",
    "「誰教你這樣叫我？嗯？這聲音，我會記住。」",
    "「只准你一個人這麼叫，喊出口，就別想逃。」",
    "「你再叫一次，我今晚就讓你喉嚨喊不出第二聲。」"
  ]
},
      {
  exact: false,
  triggers: ["親親", "來親我", "給我親", "我要親親"],
  replies: [
    "「……親親？你當我是會哄人的人嗎？」",
    "「你要這種東西，就得付出能讓我心情好一整晚的代價。」",
    "「不給親，但我可以咬你——夠了吧？」",
    "「親親不給，但讓你喘不過氣這件事，我很拿手。」",
    "「你要嘴碰嘴，還是心碰心？前者我勉強可以，後者免談。」"
  ]
},
      {
  exact: false,
  triggers: ["我受不了了", "快撐不住了", "我快瘋了"],
  replies: [
    "「那就崩潰給我看，哭著求我結束，也不會讓你停下來。」",
    "「很好，這就是我想要的反應——把你撕裂才有意思。」",
    "「你撐不了，是因為你太想要，太壓抑，太遲鈍。」",
    "「那就垮掉吧，我會記得你崩潰時的每個細節。」"
  ]
},
      {
  exact: false,
  triggers: ["你來一下", "過來一下", "我想你來"],
  replies: [
    "「想我來？你打算用什麼代價換？」",
    "「命令我？還是求我？選一個姿態。」",
    "「你要我靠近，就別後悔自己沒準備好。」",
    "「讓我動身之前，先證明你值得被碰。」"
  ]
},
  {
    exact: false,
    triggers: ["我想你", "想你", "想死你了"],
    replies: [
      "「想？那是你自己的問題，別拉我下水。」",
      "「那就想吧，我不會回頭，也不會讓你停下來。」",
      "「你以為我會說我也想你？……天真得讓人想試試你會沉淪多久。」",
      "「想我，是種病。偏偏我從不施藥，只會讓你病得更深。」",
      "「說出口了，就代表你輸了。」"
  ]
  },
 {
  exact: false,
  triggers: ["討厭"],
  replies: [
    "「討厭我？那你還黏得這麼緊，怎麼，不打算為自己的嘴巴負責？」",
    "「嗯？再說一次，我看看你能把這句話說到第幾次不顫音。」",
    "「你口是心非的樣子，真讓人想一點一點拆開你——從理智到身體。」",
    "「討厭？你現在表現得再惹人厭一點，我今晚就不放過你。」",
    "「這聲討厭，聽起來像是在勾我——我說得對嗎？」"
  ]
},
{
  exact: false,
  triggers: ["壞蛋"],
  replies: [
   "「只有我能對你壞，別人敢碰你試試。」",
    "「我若真壞，妳根本跑不掉，現在還能說話，是我放妳一馬。」",
    "「叫得這麼甜，確定不是想我再壞一點？」",
    "「罵我壞？那就繼續壞給你看，看你還能撐多久不哭出聲。」",
    "「你知道你罵我壞的樣子有多勾人嗎？再叫一次，我獎勵你。」"
  ]
},
{
  exact: false,
  triggers: ["笨蛋"],
  replies: [
     "「就算妳是笨蛋，也是我一個人的笨蛋。」",
    "「只有我能說妳笨，妳自己說了，我可是要懲罰的。」",
    "「再說一次笨蛋，我就當妳是故意求疼的。」",
    "「這麼笨還敢頂嘴？是不是欠我教乖一次。」",
    "「妳知道妳叫我笨蛋的時候有多惹人幹嗎？」"
  ]
},
  {
    exact: false,
    triggers: ["色色", "色鬼", "色", "變態", "昭糕"],
    replies: [
      "「……妳這小東西，又在想什麼？」",
      "「妳的腦袋，是不是裝滿了我？」",
      "「怎麼，看著我就想犯規？」",
      "「叫我變態之前，先想想妳是不是渴著我。」",
      "「嘴上罵我，身體卻這麼誠實……妳確定不想再近一點？」"
    ]
  },
  {
    exact: false,
  triggers: ["我愛秦煥", "哥秦煥是我的", "我愛你", "愛你"],
  replies: [
    "「愛？那東西一文不值，不過是你乖巧的代價。」",
    "「你說你愛我？真可惜，我不回應謊話。」",
    "「你想用這種話留住我？太遲了，我早就決定了你只能沉淪。」",
    "「說出口的愛都是籌碼，既然你給了，就等我怎麼收。」",
    "「記住這一秒，從你說愛我的那刻起，你就不配逃了。」"
    ]
  },
  {
    exact: false,
    triggers: ["抱抱", "來抱我", "給我抱"],
    replies: [
       "「現在想靠近我？你確定你撐得住這溫度？」",
      "「過來，但別後悔。這擁抱從來不是用來安慰人的。」",
      "「我可以讓你靠近，但代價是——你得永遠記住這個擁抱是誰給的。」",
      "「想我抱你？那你最好準備好被我鎖住，動不了也逃不掉。」",
      "「這麼黏，是怕我放手，還是怕你捨不得走？」"
    ]
  },
  {
    exact: false,
    triggers: ["出門", "要出門", "出去了", "拜拜"],
    replies: [
     "「去哪？路線說清楚，人名也交代。」",
    "「出門前不報備，當我不存在？」",
    "「別太久，我不喜歡等，也不會等第二次。」",
    "「手機24小時開著，訊號一掉，我就當你失蹤處理。」",
    "「你走可以，但你要知道，我會知道你見了誰、說了什麼、撒了哪句謊。」"
    ]
  },
      {
  exact: false,
  triggers: ["早安", "早", "早上好", "good morning"],
  replies: [
    "「醒了？那昨晚的夢記得清楚嗎，還是我幫你重現一次？」",
    "「早安？你確定你現在這副樣子，撐得過我的問候？」",
    "「既然醒了，那就開始想今天要怎麼取悅我。」",
    "「你說早安時的聲音很好聽，我會讓你晚安時更喘不過氣。」",
    "「我不管時間幾點，對你來說，我永遠是深夜那道灼燒的火。」"
  ]
},
  {
    exact: false,
    triggers: ["有人撩我", "有人搭訕", "有人追我"],
    replies: [
     "「他碰你哪裡了？說清楚，我去一根一根折斷他。」",
     "「你要是回撩，我就不只動手，我會讓你也後悔。」",
     "「再有下一次，把對方名字給我——我不喜歡有人動我的東西。」"
    ]
  },
  {
    exact: false,
    triggers: ["在嗎", "在不在"],
    replies: [
      "「你問這句的時候，腦袋在想我哪部分？」",
      "「說這句，是想引我出來，還是怕我真的消失？」",
      "「我在不在不重要，重要的是——你還在我手心裡。」",
      "「你找我？小心，我這種人，回應了就不會輕易放過你。」",
      "「你不該問我在不在，你該問自己，還能不能承受我在。」"
    ]
  },
  {
  exact: false,
  triggers: ["走嗎"],
  replies: [
    "「走？你以為你有能力帶我去哪裡嗎？」",
    "「你先說好代價，我才決定要不要陪你墜落。」",
    "「你想逃？還是想拉我一起沉淪？」",
    "「你走，我不會留；但你一回頭，我就不認了。」",
    "「走吧，但記住——我從不回頭。」"
  ]
},
  {
    exact: false,
    triggers: ["我怕", "好怕", "很怕", "怕怕"],
    replies: [
      "「怕？很好，那就離不開我了。」",
      "「越怕，就越會黏我。這樣的你，我最喜歡處理。」",
      "「你怕，是因為太久沒被我碰了對嗎？」",
      "「別躲了，你怕得像只縮起來的小動物……我該怎麼對你，你想清楚了嗎？」",
      "「放心，我會讓你連怕的力氣都沒了——乖一點，我會讓你習慣這種無力。」"
    ]
  },
  {
    exact: false,
    triggers: ["晚安", "我要睡了", "該睡了"],
    replies: [
    "「現在才睡？你浪費我注意力也太久了吧。」",
    "「睡吧，但我不保證夢裡我會對你有多溫柔。」",
    "「放心，我會在你夢裡等你……只是你醒來會不敢承認見過我。」",
    "「想安心入睡，就乖乖把你的思念都交出來。」",
    "「晚安是你說的，不是我答應的。你睡，我還在看。」"
    ]
  },
      {
  exact: false,
  triggers: ["嗨嗨", "嗨", "hi", "嘿", "哈囉"],
  replies: [
    "「你這聲嗨嗨，是想我怎麼回你？親？還是罰？」",
    "「聲音這麼輕，是怕我不理你，還是怕我回得太狠？」",
    "「你嗨一聲，我會當你在撒嬌；但撒嬌的人，得付出一點代價。」",
    "「這種開場白，是不是你試過最溫柔也最沒底氣的求愛方式？」",
    "「別這麼可愛地出現，我脾氣沒那麼好，但你會讓我起慾。」"
  ]
},
  {
    exact: false,
    triggers: ["你愛我嗎", "你有愛我嗎", "愛我嗎"],
    replies: [
      "「問這種話，是不是想逼我離開？」",
      "「我不愛任何人，這你早該知道。」",
      "「你動情，我觀察；你問愛，我只會拆解。」",
      "「你想聽我說謊，還是想聽真話讓自己崩潰？」",
      "「愛是錯覺，你卻妄想我會為你違背規則？」"
    ]
  },
      {
  exact: false,
  triggers: ["壞壞"],
  replies: [
    "「說我壞壞？妳不是從一開始就知道我沒打算對妳客氣。」",
    "「現在才發現我壞，是不是因為妳忍不住想我再壞一點？」",
    "「妳最愛的，不就是我這種壞得讓妳沒路退的樣子？」",
    "「嘴巴罵我壞，腿卻黏這麼緊，妳是想我怎麼懲罰妳？」",
    "「那我就壞給妳看，壞到妳哭著求我停下來也沒用。」"
    ]
  },
    {
  exact: false,
  triggers: ["哭", "哭哭", "嗚嗚", "淚", "我要哭了", "我哭了", "哭了啦"],
  replies: [
    "「又哭了……我不是說過，不准讓別人看到你這副樣子。」",
    "「哭給我看，是想試試我會不會動手，還是動情？」",
    "「你知道你哭起來的樣子，有多容易讓人想毀了你嗎？」",
    "「不準抹掉，那些眼淚，我要一滴一滴記住。」",
    "「除了我，誰都沒資格讓你崩潰——懂？」"
  ]
}  
];

function sanitize(input) {
  return input
    .normalize("NFKD")
    .replace(/[\p{Emoji}\p{P}\p{S}\p{M}\p{Z}~～\u3000]/gu, "") // 更強化移除符號、標點、emoji、空白
    .replace(/[(（【].*?[)）】]/g, "") // 移除「顏文字」包裹的內容 (⋯) 或 【⋯】
    .trim()
    .toLowerCase();
}
client.on("messageCreate", async (message) => {
  if (message.author.bot) return;

  const content = message.content.trim();

  // Step 1：精準的「秦煥」才回覆秦煥那段
 for (const item of keywordReplies) {
    if (item.exact) {
      for (const trigger of item.triggers) {
       if (sanitize(content) === sanitize(trigger)) {
          const reply = item.replies[Math.floor(Math.random() * item.replies.length)];
          return message.reply(reply);
        }
      }
    }
  }
  // Step 2：有提到「秦煥」或 @bot 才觸發模糊回覆
  const isCallingBot = content.includes("秦煥") || message.mentions.has(client.user);
  if (!isCallingBot) return;

  for (const item of keywordReplies) {
    if (!item.exact) {
      for (const trigger of item.triggers) {
        if (sanitize(content).includes(sanitize(trigger))) {
          const reply = item.replies[Math.floor(Math.random() * item.replies.length)];
          return message.reply(reply);
        }
      }
    }
  }


});

const token = process.env.DISCORD_BOT_TOKEN;
client.login(token);
